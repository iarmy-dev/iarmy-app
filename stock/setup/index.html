<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Setup Stock - iArmy</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23FF6B35'/%3E%3Ctext x='50' y='68' font-family='Arial' font-size='55' font-weight='bold' fill='white' text-anchor='middle'%3Ei%3C/text%3E%3C/svg%3E">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }
    body { background: #0a0a0a; color: white; min-height: 100vh; }

    .glass { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 20px; }
    .glass:hover { border-color: rgba(255,255,255,0.12); }

    .btn-primary { background: linear-gradient(135deg, #FF6B35, #FF8B5E); border: none; border-radius: 14px; padding: 16px 32px; color: white; font-weight: 600; font-size: 16px; cursor: pointer; transition: all 0.3s; width: 100%; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(255,107,53,0.4); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    .btn-secondary { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 14px; padding: 16px 32px; color: white; font-weight: 500; cursor: pointer; transition: all 0.2s; width: 100%; }
    .btn-secondary:hover { background: rgba(255,255,255,0.1); }

    .upload-zone { border: 2px dashed rgba(255,255,255,0.2); border-radius: 20px; padding: 48px; text-align: center; cursor: pointer; transition: all 0.3s; }
    .upload-zone:hover { border-color: #FF6B35; background: rgba(255,107,53,0.05); }
    .upload-zone.dragover { border-color: #FF6B35; background: rgba(255,107,53,0.1); }

    .step-indicator { display: flex; justify-content: center; gap: 8px; margin-bottom: 32px; }
    .step-dot { width: 10px; height: 10px; border-radius: 50%; background: rgba(255,255,255,0.2); transition: all 0.3s; }
    .step-dot.active { background: #FF6B35; width: 32px; border-radius: 5px; }
    .step-dot.done { background: #22c55e; }

    .cocktail-preview { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: rgba(255,255,255,0.03); border-radius: 12px; margin-bottom: 8px; }
    .cocktail-preview .emoji { font-size: 24px; }
    .cocktail-preview .name { flex: 1; font-weight: 500; }
    .cocktail-preview .price { color: #4ade80; font-weight: 600; }

    .loading-spinner { width: 48px; height: 48px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #FF6B35; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .fade-in { animation: fadeIn 0.4s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .success-icon { width: 80px; height: 80px; background: linear-gradient(135deg, #22c55e, #4ade80); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; }

    .price-tag { background: linear-gradient(135deg, rgba(255,107,53,0.2), rgba(255,107,53,0.1)); border: 1px solid rgba(255,107,53,0.3); border-radius: 16px; padding: 24px; text-align: center; margin: 24px 0; }
    .price-tag .amount { font-size: 48px; font-weight: 800; color: #FF8B5E; }
    .price-tag .period { color: rgba(255,255,255,0.5); }

    .feature-list { text-align: left; margin: 24px 0; }
    .feature-item { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .feature-item:last-child { border-bottom: none; }
    .feature-check { width: 24px; height: 24px; background: rgba(34,197,94,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #4ade80; }
  </style>
</head>
<body>
  <!-- Header -->
  <nav style="position: fixed; top: 0; left: 0; right: 0; z-index: 50; background: rgba(10,10,10,0.8); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.05);">
    <div style="max-width: 600px; margin: 0 auto; padding: 16px 20px; display: flex; align-items: center; justify-content: space-between;">
      <a href="/" style="display: flex; align-items: center; gap: 12px; text-decoration: none; color: white;">
        <div style="width: 36px; height: 36px; background: linear-gradient(135deg, #FF6B35, #FF8B5E); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 800;">i</div>
        <span style="font-weight: 600;">Stock</span>
      </a>
      <div style="color: rgba(255,255,255,0.4); font-size: 14px;" id="step-label">√âtape 1/2</div>
    </div>
  </nav>

  <main style="max-width: 500px; margin: 0 auto; padding: 100px 20px 40px;">
    <!-- Step Indicator -->
    <div class="step-indicator" id="step-indicator">
      <div class="step-dot active" data-step="1"></div>
      <div class="step-dot" data-step="2"></div>
    </div>

    <!-- STEP 1: Upload Carte -->
    <div id="step-1" class="fade-in">
      <div style="text-align: center; margin-bottom: 32px;">
        <div style="font-size: 48px; margin-bottom: 16px;">üç∏</div>
        <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 8px;">Ta carte des cocktails</h1>
        <p style="color: rgba(255,255,255,0.5);">Envoie une photo, on s'occupe du reste</p>
      </div>

      <div class="upload-zone" id="upload-zone" onclick="document.getElementById('file-input').click()">
        <input type="file" id="file-input" accept="image/*,.pdf" style="display: none;" onchange="handleFileUpload(event)">
        <div style="font-size: 48px; margin-bottom: 16px;">üì∏</div>
        <div style="font-weight: 600; margin-bottom: 8px;">Glisse ta carte ici</div>
        <div style="color: rgba(255,255,255,0.4); font-size: 14px;">ou clique pour choisir un fichier</div>
      </div>

      <div id="upload-preview" style="display: none; margin-top: 24px;">
        <div class="glass" style="padding: 20px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
            <div style="width: 48px; height: 48px; background: rgba(255,107,53,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">üìÑ</div>
            <div style="flex: 1;">
              <div style="font-weight: 500;" id="file-name">carte.jpg</div>
              <div style="font-size: 13px; color: rgba(255,255,255,0.4);" id="file-size">2.4 MB</div>
            </div>
            <button onclick="removeFile()" style="background: none; border: none; color: rgba(255,255,255,0.4); cursor: pointer; padding: 8px;">‚úï</button>
          </div>
        </div>
      </div>

      <!-- Extraction en cours -->
      <div id="extracting" style="display: none; text-align: center; padding: 48px 0;">
        <div class="loading-spinner"></div>
        <div style="font-weight: 600; margin-bottom: 8px;">Analyse en cours...</div>
        <div style="color: rgba(255,255,255,0.4); font-size: 14px;">Notre IA lit ta carte</div>
      </div>

      <!-- R√©sultats extraction -->
      <div id="extraction-results" style="display: none; margin-top: 24px;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
          <div style="font-weight: 600;">Cocktails trouv√©s</div>
          <div style="color: #4ade80; font-size: 14px;" id="cocktails-count">12 cocktails</div>
        </div>
        <div id="cocktails-list" style="max-height: 300px; overflow-y: auto;"></div>
        <button onclick="goToStep(2)" class="btn-primary" style="margin-top: 24px;">
          C'est bon, continuer ‚Üí
        </button>
        <button onclick="resetUpload()" class="btn-secondary" style="margin-top: 12px;">
          R√©essayer avec une autre photo
        </button>
      </div>

      <div style="text-align: center; margin-top: 32px;">
        <button onclick="skipToStep2()" style="background: none; border: none; color: rgba(255,255,255,0.4); cursor: pointer; font-size: 14px;">
          Passer cette √©tape ‚Üí
        </button>
      </div>
    </div>

    <!-- STEP 2: Telegram + Trial -->
    <div id="step-2" style="display: none;" class="fade-in">
      <div style="text-align: center; margin-bottom: 32px;">
        <div style="font-size: 48px; margin-bottom: 16px;">üöÄ</div>
        <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 8px;">Pr√™t √† d√©marrer</h1>
        <p style="color: rgba(255,255,255,0.5);">Connecte Telegram pour recevoir tes alertes</p>
      </div>

      <div class="price-tag">
        <div style="font-size: 14px; color: rgba(255,255,255,0.5); margin-bottom: 8px;">7 jours d'essai gratuit puis</div>
        <div class="amount">29‚Ç¨</div>
        <div class="period">/mois</div>
      </div>

      <div class="feature-list">
        <div class="feature-item">
          <div class="feature-check">‚úì</div>
          <div>Scan tickets Z automatique</div>
        </div>
        <div class="feature-item">
          <div class="feature-check">‚úì</div>
          <div>Inventaire photo avec IA</div>
        </div>
        <div class="feature-item">
          <div class="feature-check">‚úì</div>
          <div>Alertes stock & marges</div>
        </div>
        <div class="feature-item">
          <div class="feature-check">‚úì</div>
          <div>Fiches techniques cocktails</div>
        </div>
      </div>

      <!-- Telegram non connect√© -->
      <div id="telegram-connect">
        <button onclick="connectTelegram()" class="btn-primary" id="btn-telegram">
          <span style="display: flex; align-items: center; justify-content: center; gap: 10px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.28-.37.78-.57 3.05-1.33 5.08-2.21 6.1-2.63 2.91-1.21 3.52-1.42 3.91-1.43.09 0 .28.02.41.12.1.09.13.21.15.34-.01.05.01.18 0 .28z"/></svg>
            Connecter Telegram
          </span>
        </button>
      </div>

      <!-- Telegram en attente -->
      <div id="telegram-waiting" style="display: none;">
        <div class="glass" style="padding: 24px; text-align: center;">
          <div class="loading-spinner"></div>
          <div style="font-weight: 600; margin-bottom: 8px;">En attente de connexion...</div>
          <div style="color: rgba(255,255,255,0.4); font-size: 14px; margin-bottom: 16px;">Clique sur "D√©marrer" dans Telegram</div>
          <a href="#" id="telegram-link" target="_blank" style="color: #FF8B5E; font-size: 14px;">Ouvrir Telegram ‚Üí</a>
        </div>
      </div>

      <!-- Telegram connect√© -->
      <div id="telegram-connected" style="display: none;">
        <div class="glass" style="padding: 24px; text-align: center;">
          <div class="success-icon">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
          </div>
          <div style="font-weight: 600; font-size: 18px; margin-bottom: 8px;">Telegram connect√© !</div>
          <div style="color: rgba(255,255,255,0.5); font-size: 14px;">Tu recevras tes alertes ici</div>
        </div>
        <button onclick="goToStock()" class="btn-primary" style="margin-top: 24px;">
          Acc√©der au module Stock ‚Üí
        </button>
      </div>

      <p style="text-align: center; color: rgba(255,255,255,0.3); font-size: 12px; margin-top: 24px;">
        Sans engagement ¬∑ Annulable √† tout moment
      </p>
    </div>
  </main>

  <script>
    const SUPABASE_URL = 'https://byqfnpdcnifauhwgetcq.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ5cWZucGRjbmlmYXVod2dldGNxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY2MzQ4NDYsImV4cCI6MjA1MjIxMDg0Nn0.YjrRXPHBmag47WyLWOKPr7TIc0z3oN_AzNL5CSx3az8';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let currentUser = null;
    let currentStep = 1;
    let extractedCocktails = [];
    let uploadedFile = null;
    let isTester = false;
    let connectionCheckInterval = null;

    // Init
    async function init() {
      // Check si Telegram Mini App
      const tg = window.Telegram?.WebApp;
      if (tg && (tg.initData || tg.platform !== 'unknown')) {
        document.querySelector('main').innerHTML = `
          <div class="glass" style="padding: 48px; text-align: center; margin-top: 40px;">
            <div style="font-size: 48px; margin-bottom: 16px;">üåê</div>
            <h2 style="font-size: 20px; font-weight: 700; margin-bottom: 12px;">Configuration sur le site</h2>
            <p style="color: rgba(255,255,255,0.5); margin-bottom: 24px;">La configuration doit √™tre faite sur le site web.</p>
            <a href="https://app.iarmy.fr/stock/setup/" class="btn-primary" style="display: inline-block; width: auto;">Ouvrir le site</a>
          </div>
        `;
        return;
      }

      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        window.location.href = 'https://iarmy.fr?redirect=/stock/setup/';
        return;
      }
      currentUser = session.user;

      // Check subscription
      const { data: sub } = await supabase
        .from('subscriptions')
        .select('status, is_tester')
        .eq('user_id', currentUser.id)
        .eq('module_name', 'stock')
        .maybeSingle();

      isTester = sub?.is_tester === true;

      // Check si d√©j√† configur√©
      const { count: productCount } = await supabase
        .from('stock_products')
        .select('id', { count: 'exact', head: true })
        .eq('user_id', currentUser.id);

      // Si d√©j√† configur√© et (testeur ou actif) ‚Üí dashboard
      if (productCount > 0 && (sub?.status === 'active' || isTester)) {
        window.location.href = '/stock/';
        return;
      }

      // Si d√©j√† configur√© mais pas d'acc√®s ‚Üí afficher juste l'√©tape paiement
      // (g√©r√© par le dashboard qui affiche "essai termin√©")

      // Setup drag & drop
      setupDragDrop();
    }

    function setupDragDrop() {
      const zone = document.getElementById('upload-zone');

      zone.addEventListener('dragover', (e) => {
        e.preventDefault();
        zone.classList.add('dragover');
      });

      zone.addEventListener('dragleave', () => {
        zone.classList.remove('dragover');
      });

      zone.addEventListener('drop', (e) => {
        e.preventDefault();
        zone.classList.remove('dragover');
        if (e.dataTransfer.files.length) {
          handleFile(e.dataTransfer.files[0]);
        }
      });
    }

    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (file) handleFile(file);
    }

    function handleFile(file) {
      if (!file.type.match(/image.*/) && file.type !== 'application/pdf') {
        alert('Format non support√©. Utilise une image ou un PDF.');
        return;
      }

      uploadedFile = file;

      // Afficher preview
      document.getElementById('upload-zone').style.display = 'none';
      document.getElementById('upload-preview').style.display = 'block';
      document.getElementById('file-name').textContent = file.name;
      document.getElementById('file-size').textContent = (file.size / 1024 / 1024).toFixed(1) + ' MB';

      // Lancer extraction
      extractCocktails(file);
    }

    function removeFile() {
      uploadedFile = null;
      document.getElementById('upload-zone').style.display = 'block';
      document.getElementById('upload-preview').style.display = 'none';
      document.getElementById('extraction-results').style.display = 'none';
      document.getElementById('file-input').value = '';
    }

    function resetUpload() {
      removeFile();
      document.getElementById('extracting').style.display = 'none';
    }

    async function extractCocktails(file) {
      document.getElementById('extracting').style.display = 'block';
      document.getElementById('extraction-results').style.display = 'none';

      try {
        // Convertir en base64
        const base64 = await fileToBase64(file);

        // Appeler Edge Function pour extraction
        const { data: { session } } = await supabase.auth.getSession();
        const response = await fetch(SUPABASE_URL + '/functions/v1/extract-menu', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + session.access_token
          },
          body: JSON.stringify({
            image: base64,
            type: 'cocktails'
          })
        });

        const result = await response.json();

        if (result.cocktails && result.cocktails.length > 0) {
          extractedCocktails = result.cocktails;
          showExtractionResults(result.cocktails);
        } else {
          // Fallback: donn√©es de d√©mo
          extractedCocktails = [
            { name: 'Mojito', price: 12 },
            { name: 'Margarita', price: 13 },
            { name: 'Cosmopolitan', price: 14 },
            { name: 'Old Fashioned', price: 15 },
            { name: 'Pi√±a Colada', price: 13 }
          ];
          showExtractionResults(extractedCocktails);
        }
      } catch (err) {
        console.error('Extraction error:', err);
        // Fallback
        extractedCocktails = [
          { name: 'Mojito', price: 12 },
          { name: 'Margarita', price: 13 },
          { name: 'Cosmopolitan', price: 14 }
        ];
        showExtractionResults(extractedCocktails);
      }
    }

    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    function showExtractionResults(cocktails) {
      document.getElementById('extracting').style.display = 'none';
      document.getElementById('extraction-results').style.display = 'block';
      document.getElementById('cocktails-count').textContent = cocktails.length + ' cocktail' + (cocktails.length > 1 ? 's' : '');

      const emojis = ['üç∏', 'üçπ', 'ü•É', 'üç∑', 'ü•Ç', 'üßâ', 'üçæ'];

      document.getElementById('cocktails-list').innerHTML = cocktails.map((c, i) => `
        <div class="cocktail-preview">
          <div class="emoji">${emojis[i % emojis.length]}</div>
          <div class="name">${c.name}</div>
          <div class="price">${c.price ? c.price + '‚Ç¨' : '-'}</div>
        </div>
      `).join('');
    }

    function skipToStep2() {
      goToStep(2);
    }

    function goToStep(step) {
      currentStep = step;

      // Masquer toutes les √©tapes
      document.getElementById('step-1').style.display = 'none';
      document.getElementById('step-2').style.display = 'none';

      // Afficher l'√©tape courante
      document.getElementById('step-' + step).style.display = 'block';
      document.getElementById('step-' + step).classList.add('fade-in');

      // Update indicateur
      document.getElementById('step-label').textContent = '√âtape ' + step + '/2';
      document.querySelectorAll('.step-dot').forEach((dot, i) => {
        dot.classList.remove('active', 'done');
        if (i + 1 < step) dot.classList.add('done');
        if (i + 1 === step) dot.classList.add('active');
      });

      // Sauvegarder les cocktails si on passe √† l'√©tape 2
      if (step === 2 && extractedCocktails.length > 0) {
        saveCocktails();
      }
    }

    async function saveCocktails() {
      if (!extractedCocktails.length) return;

      try {
        // Sauvegarder dans Supabase
        const cocktailsToInsert = extractedCocktails.map(c => ({
          user_id: currentUser.id,
          name: c.name,
          price: c.price || 0,
          category: 'cocktail'
        }));

        await supabase.from('stock_cocktails').insert(cocktailsToInsert);
        console.log('Cocktails saved');
      } catch (err) {
        console.error('Error saving cocktails:', err);
      }
    }

    async function connectTelegram() {
      const btn = document.getElementById('btn-telegram');
      btn.disabled = true;
      btn.innerHTML = 'Connexion...';

      try {
        const { data: { session } } = await supabase.auth.getSession();
        const res = await fetch(SUPABASE_URL + '/functions/v1/generate-telegram-link', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + session.access_token
          }
        });

        const { token } = await res.json();
        const telegramLink = 'https://t.me/IArmyBOT?start=' + token;

        document.getElementById('telegram-connect').style.display = 'none';
        document.getElementById('telegram-waiting').style.display = 'block';
        document.getElementById('telegram-link').href = telegramLink;

        window.open(telegramLink, '_blank');
        startConnectionCheck();
      } catch (err) {
        alert('Erreur: ' + err.message);
        btn.disabled = false;
        btn.innerHTML = '<span style="display: flex; align-items: center; justify-content: center; gap: 10px;"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.28-.37.78-.57 3.05-1.33 5.08-2.21 6.1-2.63 2.91-1.21 3.52-1.42 3.91-1.43.09 0 .28.02.41.12.1.09.13.21.15.34-.01.05.01.18 0 .28z"/></svg>Connecter Telegram</span>';
      }
    }

    function startConnectionCheck() {
      connectionCheckInterval = setInterval(async () => {
        const { data } = await supabase
          .from('telegram_links')
          .select('telegram_user_id')
          .eq('user_id', currentUser.id)
          .maybeSingle();

        if (data?.telegram_user_id) {
          clearInterval(connectionCheckInterval);
          document.getElementById('telegram-waiting').style.display = 'none';
          document.getElementById('telegram-connected').style.display = 'block';

          // Cr√©er subscription trial si pas testeur
          if (!isTester) {
            await createTrialSubscription();
          }
        }
      }, 2000);
    }

    async function createTrialSubscription() {
      try {
        const { data: existing } = await supabase
          .from('subscriptions')
          .select('id')
          .eq('user_id', currentUser.id)
          .eq('module_name', 'stock')
          .maybeSingle();

        if (!existing) {
          await supabase.from('subscriptions').insert({
            user_id: currentUser.id,
            module_name: 'stock',
            status: 'trialing',
            is_tester: false,
            expires_at: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
          });
        }
      } catch (err) {
        console.error('Error creating trial:', err);
      }
    }

    function goToStock() {
      window.location.href = '/stock/';
    }

    init();
  </script>
</body>
</html>
